<!DOCTYPE html>
<html>
<head>
  <title>Qt: интерфейс, и не только</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link type="text/css" href="css/css.css" rel="stylesheet"/>
  <link type="text/css" href="css/sh.css" rel="stylesheet"/>
  <script language="javascript" src="js/shInit.js"></script>
  <script language="javascript" src="js/shCore.js"></script>
  <script language="javascript" src="js/shBrushDelphi.js"></script>
  <script language="javascript" src="js/shBrushSql.js"></script>
</head>
<body>
<div id="layout">
<div id="header">
  <a title="DRKB Library" href="../splash.html"><div id="logo"></div></a>
</div>
<div id="content">
<div id="explorer">DRKB Explorer</div>
  <h1 id="title">Qt: интерфейс, и не только</h1>
<div id="date">01.01.2010</div>
<p>QT: интерфейс, и не только... </p>
<p class="p_Heading1" style="text-align: center;">&nbsp;</p>
<p>Если вы связаны с программированием, то наверняка уже встречали сочетание Qt. Многие (0,1%) из вас даже использовали Qt в своих разработках, пусть даже как следствие инсталляции Borland Kylix. В общем, самое время посмотреть на Qt, что называется, "в упор, двумя глазами"&#8230;</p>
<p>&nbsp;<br>
<p>Этот продукт на слуху у всех разработчиков, которые программируют для Linux. И не только у них &#8212; например, самый модный и удобный многоплатформенный клиент для сетей AIM/ICQ (точнее, ICQ/AIM), sim, написанный питерцем Володей Шутовым, создан именно с использованием Qt. Не говоря уже о Borland Kylix &#8212; там вообще все работает поверх Qt.</p>
<p>&nbsp;<br>
<p>Такие совпадения &#8212; там вилочка, тут ножичек &#8212; поневоле задумаешься&#8230;</p>
<p>&nbsp;<br>
<p>Идея</p>
<p>&nbsp;<br>
<p>Норвежская компания Trolltech AG (изначально называвшаяся Quasar Technologies, откуда, собственно, и пошла аббревиатура Qt) образовалась из двух (хм&#8230;) норвежцев, Эйрика Енга (Eirik Eng) и Хаварда Норта (Haavard Nort) с целью&#8230; короче, как всегда, с целью подрубить бабла. Но, кроме того, еще и создать пару нетленок из разряда универсальных библиотек, которые завоюют весь мир. Уж такой народ норвежцы &#8212; не могут без славы и денег.</p>
<p>&nbsp;<br>
<p>Дело было в 1994 г. в городе Осло. Само сочетание "Qt" некоторые произносят как "кьют" ака cute &#8212; то есть "мило, прикольно". В общем-то, так оно и есть, если, конечно, вы способны оценить красоту, выраженную в терминах С++.</p>
<p>&nbsp;<br>
<p>Говоря более конкретно, во главу угла были поставлены две вещи. Первое: библиотеки создавались для языка С++. Второе: основой всему был именно интерфейс пользователя, поскольку это самый несовместимый и позорный момент во всем софтвере &#8212; полностью разные парадигмы графического пользовательского интерфейса.</p>
<p>&nbsp;<br>
<p>Как известно, MS Windows использует "локальный" GUI API, который, однако, недавно был транспонирован на сетевые подключения в XP Remoting. Все UNIX-like, и Linux в том числе, были изначально (ну, как изначально &#8212; как только рабочие станции доросли до графики, естественно) завязаны на X Windows, который, хоть и работает от рождения по сети, но локально показывает худшие характеристики быстродействия и реактивности из всех рассматриваемых интерфейсов. Наконец, графика Mac OS, зашитая полуаппаратно в фирменных BIOS-"тулбоксах", всегда показывала скорость и красоту, даже когда Windows еще под стол пешком ходила. Но это было: а) проприетарно, б) ни с чем не совместимо &#8212; даже приблизительно.</p>
<p>&nbsp;<br>
<p>Короче &#8212; бардак и брожение умов. Вот прибалты и задумались&#8230;</p>
<p>&nbsp;<br>
<p>Точнее задумались-то не только они. В качестве переносимого графического интерфейса можно использовать хоть Java, хоть Tk/Tcl, а хоть и Macromedia Flash &#8212; на последних версиях этого Flash можно писать вполне приличные приложения. Это только те "задумавшиеся", у кого получилось,&#8212; об остальных мы просто не знаем.</p>
<p>&nbsp;<br>
<p>Да, так вот, у Trolltech тоже неплохо получилось, как именно &#8212; сейчас посмотрим.</p>
<p>&nbsp;<br>
<p>Кю-тэшное семейство, обзор</p>
<p>&nbsp;<br>
<p>На самом деле существует несколько продуктов Qt, хотя все они "завязаны" на одном и том же коде. Собственно Qt &#8212; это межплатформенная библиотека для С++. Более конкретно &#8212; библиотека классов, "цешники"-натуралы отдыхают. То есть это даже и библиотекой-то не назовешь &#8212; сами создатели именуют это как framework, то есть программная оболочка. Но, конечно, от этого она не перестает быть обычной библиотекой.</p>
<img src="pic/clip0254.gif" width="308" height="224" border="0" alt="clip0254"></p>
<p>Применение нового "стиля" в Qt может мгновенно придать вашему приложению новый вид</p>
<p>&nbsp;<br>
<p>Помимо переносимого интерфейса библиотека также занимается интернационализацией, то есть располагает инструментом для перевода интерфейса на ваш родной китайский язык (сделано это, кстати, очень прикольно). Менеджер релизов выкусывает из кода все строки, подлежащие переводу. Они должны быть, правда, особого формата, чтоб не было накладок с непереводимыми фразами. Короче, полученные таблицы фраз поступают в средство перевода &#8212; Linguist. Сам он ничего не переводит (это делаете вы) &#8212; но зато помогает сохранять уже переведенные фразы в словарях. Так что вы можете менять программу как вам угодно, и то, что уже переведено, уже никогда не будет требовать перевода.</p>
<p>&nbsp;<br>
<p>Третье, что было сделано (кстати, уже по ходу разработки &#8212; по просьбе многих клиентов), это системно-независимые механизмы доступа к базам данных. Конечно, я уже не говорю о таких вещах, как унифицированный сетевой доступ, XML, трехмерная графика и так далее &#8212; просто различия в этих сферах не так разительны, как в перечисленных выше.</p>
<p>&nbsp;<br>
<p>Выходит, что Qt &#8212; это как бы "мегапатч" к стареньким си-либам, позволяющий:</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 7px 0px 7px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>работать в графике; </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 7px 0px 7px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>переводить программы; </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 7px 0px 7px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>выполнять запросы к БД; </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 7px 0px 7px 24px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>унифицированно реализовывать все остальное, вроде мультимедиа.</td></tr></table></div><p>Помимо основной библиотеки, существует основанный на том же коде framework для всякой мобильной живности вроде смарт-фонов и PDA под управлением Embedded Linux (особенно засветился в этом секторе Sharp). Называется эта штуковина Qtopia. Инструмент для разработки встроенных систем с ограниченной функциональностью называется Qt/Embedded.</p>
<p>&nbsp;<br>
<p>Далее, QSA &#8212; скриптовый язык, позволяющий управлять готовыми приложениями на Qt/C и расширять их возможности в скриптовом контексте.</p>
<p>&nbsp;<br>
<p>Teambuilder &#8212; средство компиляции, которое собирает статистику утилизации CPU по целой рабочей группе и позволяет оптимизировать процесс сборки на менее загруженных станциях.</p>
<p>&nbsp;<br>
<p>Ко всему, существует несколько "плугов" для известных сред разработки (говоря проще &#8212; для Visual Studio и Borland Builder), упрощающих разработку под Qt,&#8212; Qt Solutions.</p>
<p>&nbsp;<br>
<p>В качестве визуального инструмента разработки используется Qt Designer &#8212; это "малевалка" интерфейса, подобная всем "клик-энд-го". Конечно, еще полно полезного хелпняка: просто тысячи артиклов, плюс девяносто шесть (проверьте) примеров &#8212; и это есть гуд.</p>
<p>&nbsp;<br>
<p>Однако сосредоточимся на Qt &#8212; все остальное вторично.</p>
<p>&nbsp;<br>
<p>Инсталл</p>
<p>&nbsp;<br>
<p>Конечно же, сначала следует проинсталлировать систему. Под Windows нужно обратить внимание на три вещи. Во-первых, потребуется ввести имя пользователя, компанию и сериал. Вводите их точно в таком же виде, как указано в письме, которое вам придет (сериал является хеш-фанкшином от даты активации и двух остальных полей) &#8212; иначе ничего работать не будет.</p>
<p>&nbsp;<br>
<p>Во-вторых, при инсталляции предпоследним пунктом идет установка примеров. Они приходят в виде исходных текстов, но в процессе установки будут компилироваться. Компиляция происходит в командной строке, так что без установленных переменных окружения это не сработает, получите ошибку "где линкер дел, гад?". Пофиксить проблему просто: создайте и запустите bat-файл типа:</p>
<p>call "C:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Tools\vsvars32.bat"<br>
<p>qt-win-eval-msvc-3.3.3.exe</p>
<p>Третья заморочка: примеры и туторы тоже так просто работать не станут. Они не могут найти свою библиотеку, хотя в переменной пути к ней все вроде и указано. На самом деле для правильной работы нужно установить переменные окружения &#8212; а они, в свою очередь, устанавливаются при загрузке профиля пользователя. Даже и перезагружаться не нужно, просто отлогоньтесь-прилогоньтесь. Кстати, о необходимости такой операции пишется в конце инсталляции &#8212; но кто же такое читает?</p>
<p>&nbsp;<br>
<p>Если вы инсталлируетесь под Linux и BSD, то я вам ничего не стану рассказывать &#8212; сами с ушами. Скажу только, что уровень проблем при инсталляции под этой ОС может колебаться в очень больших пределах, в зависимости от поддержки вашего дистрибутива и его "комплектации" на момент установки. Я ставил на Slakware, RH и Mandrake без особых проблем. В любом случае Qt нужно ставить на KDE.</p>
<p>&nbsp;<br>
<p>Библиотека, learning curve</p>
<p>&nbsp;<br>
<p>Как я уже говорил, Qt &#8212; это библиотека классов. Классов там более четырехсот, так что, если начальник требует, чтобы вы начали кодить на Qt с завтрашнего дня, то лучше послать его к ежам. Придется, как минимум, пару недель изучать доки, а лучше прочитать книжку. Я за целую ночь не смог воткнуть даже простецкие вещи. Вам тоже торопиться не советую, лучше делать все правильно &#8212; от простого к сложному.</p>
<p>&nbsp;<br>
<p>Может быть, не первая по важности, но несомненно нужная после инсталляции вещь &#8212; просмотр, распечатка, (а возможно, и татуировка на груди &#8212; вверх ногами, чтобы читать было удобно) иерархии классов Qt.</p>
<p>&nbsp;<br>
<p>Это, в общем-то, относится к любой библиотеке. Но в некоторых "системах ценностей" вы можете прожить три жизни, и проходить при этом "в лаптях", то есть использовать 3% от всех возможностей, обходя стороной то, что, собственно, и составляет ценность продукта. Пример: множество малопонятных функций в MS Exсel, масса никому не нужных ActiveX-компонент (помните, как они продавались почти по одной штучке &#8212; во цирк!) и т.д. В Qt все несколько иначе &#8212; вы в конце концов будете использовать 50-80% всех классов, так что "отбыть номер" не удастся.</p>
<p>&nbsp;<br>
<img src="pic/clip0256.gif" width="1505" height="938" border="0" alt="clip0256"><br>
<p>Общий вид иерархии классов Qt</p>
<p>&nbsp;<br>
<p>Непременно прочитайте whitepapers &#8212; в отличие от других "белок", это не просто набор рекламных лозунгов. После чтения приведенных там примеров вы даже сможете построить несколько приложений.</p>
<p>&nbsp;<br>
<p>Как маршрут для вечерних прогулок вы должны избрать посещение сайта http://doc.trolltech.com/3.3/ &#8212; вас там многое заинтересует, начиная, конечно, с How To Learn Qt. Собственно, всегда лучше начинать с голого кодирования, не пользуясь автогенераторами &#8212; или пользуясь, но при этом тщательно разбирая код. В противном случае вы напишете что-то, что потом не сможете ни объяснить, ни поддержать, ни модифицировать.</p>
<p>&nbsp;<br>
<p>Как оно работает</p>
<p>&nbsp;<br>
<p>Говоря в общем, все вращается вокруг событий, называемых сигналами, и слотов &#8212; то есть регистрируемых реакций на эти события. В отличие от других "закрытых" событийных множеств (вроде тех, что встречаются в Active Script) система сигналов Qt полностью динамическая &#8212; каждый участок кода может регистрировать или обрабатывать сигналы. Это напоминает механизм, условно известный как WM_USER+1.</p>
<p>&nbsp;<br>
<p>Сигналы имеют отдаленное отношение к системным событиям и являются их произвольной трансляцией &#8212; так же как это реализовано в Delphi. Естественно, что ни одна система не должна порождать таких шквалов нотификаций, как Windows. Обеспечивать приложению доступ к событиям неклиентской области &#8212; по-моему, большая ошибка архитекторов этой системы, породившая немало "смешных" интерфейсов.</p>
<p>&nbsp;<br>
<p>Что касается графического интерфейса, то он более всего похож на Java Swing &#8212; тут тоже существуют схемы стилей, например Windows, CDE, Motif, копирующие известные оболочки. Присутствуют также layout&#8217;ы, автоматически размещающие элементы управления; кроме того, есть такие "пружинки", или "спейсеры", которые расталкивают сопредельные компоненты.</p>
<p>&nbsp;<br>
<p>Есть также немало вещей, напоминающих Delphi: хинты размеров (то есть "как было бы лучше"), масштабирование компонент и прочие вещи, претендующие на красивость.</p>
<p>&nbsp;<br>
<p>Как и в Swing, все элементы перерисованы от руки, то есть стандартные механизмы рисования элементов управления не применяются &#8212; вместо этого используется, например, GDI WinAPI. Автоматически определяется версия ОС и, соответственно, реализуются или игнорируются те или иные свойства, вроде прозрачности или XP-прибамбасов. В качестве небольшого попуска Qt использует стандартные диалоговые окна Windows, в частности диалоги открытия файла и настойки печати.</p>
<p>&nbsp;<br>
<p>Под X11 Qt не использует тулкиты вроде Motif или Xt &#8212; ну, Qt вроде и сам такой же тулкит (то есть &#8212; зачем же?). Вместо этого напрямую используется Xlib &#8212; с расширениями вроде RENDER, если они доступны.</p>
<p>&nbsp;<br>
<p>Схема "генеральной помпы", то есть основного цикла событий, не очень отличается от всех подобных во всех ОС &#8212; от MS Windows до PalmOS. Приложение строится просто, если не сказать примитивно: создается главное окно, устанавливаются его параметры, после чего приложение непосредственно "ранится". Вот как выглядит известный всем "Привет, мир!":</p>
<pre name="code" class="delphi">
#include &lt; qapplication.h &gt;
#include &lt; qlabel.h &gt;
int main( int argc, char **argv )
{
QApplication app( argc, argv );
QLabel *hello = new QLabel( "Привет, мир!", 0 );
app.setMainWidget( hello );
hello-&gt;show();
return app.exec();
}
</pre>

<p>Естественно, это вам не Visual Basic: вы можете создавать собственные элементы управления &#8212; это, как и в Delphi, поощряется, а не наоборот. Писать их не сложнее, чем дельфийские, а то и проще. Вот, к примеру, как реализуются LCD-часы на основе класса, отрисовывающего LCD-строку:</p>
<pre name="code" class="delphi">
#include &lt; qdatetime.h &gt;
#include "clock.h"
Clock::Clock( QWidget *parent, const char *name )
: QLCDNumber( parent, name ), showingColon( true ) {
showTime();
startTimer( 1000 );
}
void Clock::timerEvent( QTimerEvent * ) { showTime(); }
void Clock::showTime() {
QString time = QTime::currentTime().toString().left( 5 );
if ( !showingColon ) time[2] = ’ ’;
display( time );
showingColon = !showingColon;
}
</pre>

<p>Не сложно &#8212; а если б выключить мигание двух точек, так и вовсе тривиально. Кстати, мне показалось что знак "!" перед showingColon можно "сэкономить" &#8212; ну, конечно, заменив для мнемоничности showcolon на hidecolon. Да и showTime() в конструкторе можно бы убрать&#8230;</p>
<p>&nbsp;<br>
<p>Короче, в полном ходу лозунг Trolltech: code_less &amp;&amp; create_more &#8212; только не стоит вычислять эту выражение по короткой схеме :).</p>
<p>&nbsp;<br>
<p>Интеграция</p>
<p>&nbsp;<br>
<p>Это, конечно, не бог весть что, но, тем не менее, приятно и весьма полезно &#8212; Qt во время инсталляции интегрируется в Visual Studio, так что вы сможете добавлять потом новые проекты, формы и т.д. прямо из дополнительной панельки. Кроме того, там доступно быстрое переключение на подсказку в QtAssistant &#8212; раз уж вся среда не зависит от платформы, было бы просто позором сделать справку по ее системе. В результате html&#8217;ные "хелпы" от Microsoft тут нет &#8212; вместо них используются похожие, но собственного формата и, естественно, с оболочкой на самом Qt.</p>
<p><img src="pic/clip0257.gif" width="388" height="264" border="0" alt="clip0257"></p>
<p>Qt также хорошо интегрируется в Visual Studio, хотя это и не совсем то, для чего он создавался</p>
<p>&nbsp;<br>
<p>Аллилуя, то есть Славься!</p>
<p>&nbsp;<br>
<p>Я не преследовал цели посвятить вас в самые сложные вещи Qt &#8212; точнее, таких вещей я там и не заметил. Всё ровно, логично, слаженно, сбито и задокументированно. Конечно, были и будут баги, возникают новые возможности &#8212; но для этого есть огромное сообщество разработчиков, да и конфы в Сети просто ужасно большое количество. В общем, с проблемами не "подвиснете". Кстати, и исходный код можно посмотреть, если уж что-то совсем непонятно, а при желании можно даже частично перекомпилировать. Этого я, правда, делать не советую &#8212; расстанетесь с совместимостью. Лучше станьте контрибьютором &#8212; а там, чего доброго, дорастете до должности "платного друга Trolltech", я бы гордился.</p>
<p>&nbsp;<br>
<p>В заключение хочу сказать, что в процессе "кьютизаци" вы можете круто сэкономить на интернете &#8212; на КП-диске лежат отличные фрагменты видео, поясняющие концепции Qt, что называется, устами создателей. Там же &#8212; whitepapers. Там же &#8212; триальные инсталляшки Qt и QSA для Windows и X11. Для регистрации триала зайдите на сайт www.trolltech.com/download/index.html?cid=20 и зарегистрируйтесь без закачки, ключи придут по почте. Бесплатные версии для Линукс лучше всего закачать с сайта дистрибутива в виде пакета, чтобы не морочиться с компиляций &#8212; в последние дистро все и так наверняка включено, просмотрите список доступных пакетов, если что.</p>
<p>&nbsp;<br>
<p>Короче: надумаете начинать новый портабельный "высокооктановый" проект&#8230; ну вы уже поняли, что делать. После "пингвинизации" Китая компанией Sun (контракт на поставку 200 миллионов пингвинов&#8230;) вам будет просто скучно писать для MS Windows. Хотя, с другой стороны, Билла Гейтса тоже еще никто не отменял, так что не без этого &#8212; лучше сохранять совместимость.</p>
<p>&nbsp;<br>
<p>Кстати, кто первый создаст аутсорсинг "QTWorks.ua" &#8212; тот может реально подрубить не только у нас на районе, но и в окружающих поселениях, типа России, Германии и Кореи, поскольку в ближайшее время значение Linux-приложений во "взрослых" странах будет только расти.</p>
<p>В статье использованы материалы и примеры с сайта trolltech.com.</p>
<p>&nbsp;<br>
2004.10.25 Автор: Арсений Чеботарев <br>
<a href="http://www.cpp.com.ua/" target="_blank">http://www.cpp.com.ua/</a></p>
</div>

<div id="footer">
<hr/>
<p>Материал из DRKB Library<br/>Разработка и поддержка &mdash; <a title="DRKB на GitHub" href="https://github.com/quadroid/drkb" target="_blank">Quadr0</a></p>
</div>
</div>
</body>
</html>
