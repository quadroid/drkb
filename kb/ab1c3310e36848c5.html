<!DOCTYPE html>
<html>
<head>
  <title>Создание отчетов с помощью Quick Report 3 (статья)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link type="text/css" href="css/css.css" rel="stylesheet"/>
  <link type="text/css" href="css/sh.css" rel="stylesheet"/>
  <script language="javascript" src="js/shInit.js"></script>
  <script language="javascript" src="js/shCore.js"></script>
  <script language="javascript" src="js/shBrushDelphi.js"></script>
  <script language="javascript" src="js/shBrushSql.js"></script>
</head>
<body>
<div id="layout">
<div id="header">
  <a title="DRKB Library" href="../splash.html"><div id="logo"></div></a>
</div>
<div id="content">
<div id="explorer">DRKB Explorer</div>
  <h1 id="title">Создание отчетов с помощью Quick Report 3 (статья)</h1>
<div id="date">01.01.2010</div>

<p>Создание отчетов с помощью</p>
<p>QuickReport 3</p>
<p>Что такое QuickReport 3?</p>
<p>QuickReport 3 это набор компонент для Delphi позволяющий вам построить отчет из базы данных быстро и просто. Позволяет не только отпечатать отчет, но и просмотреть его на экране, что позволяет пользователю проверить результат без порчи бумаги и экспортировать отчет в другие форматы, такие как простой ASCII текст, текст разделенный запятыми (CSV) и в HTML.</p>
<p>QuickReport сам написан на Delphi и знает все про модель Delphi обработки баз данных. Поэтому вы можете для создания отчетов в традиционных базах данных, базирующихся на BDE, таких как Paradox и dBase, клиентских наборов данных используемых в многоуровневой среде (multi-tier), новое для Delphi 5 ADO и Interbase Express components, так же альтернативные движки третьих сторон, такие как Apollo. Вы можете использовать QuickReport и для печати данных не из баз, если в этом есть потребность.</p>
<p>Данное руководство разработано для того, что бы быстрее освоить QuickReport, так что вы можете немедленно начать использовать его в ваших приложениях.</p>
А также</p>
<p>QuickReport это прекрасный продукт, но если вам нужны расширенные возможности, то вы можете их расширить с помощью QuickReport Pro. В версию Pro включено все, что имеется в обычной версии плюс:</p>
<table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">&#183;</td><td>Три дополнительных фильтра:</td></tr></table><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 19px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>Excel XLS: XLS фильтр совместим с версией Excel 4 и позже, и предоставляет простой и надежный механизм для экспортирования данных в электронную таблицу.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 19px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2.</td><td>Rich Text RTF: RTF фильтр базируется на спецификации Microsoft RTF версии 1.5, поддерживает больше возможностей, чем TRichEdit.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 19px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3.</td><td>Windows Metafile WMF: WMF фильтр позволяет сохранить отчет в мета графическом формате.</td></tr></table></div><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">&#183;</td><td>Несколько дополнительных компонент. </td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1.</td><td>TQREditor построитель отчетов для конечного пользователя, что позволяет поставлять отчеты отдельно от программы.</td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2.</td><td>TQuickAbstractRep наследник от базового класса TcustomQuickRep, который не использует TDataset - используйте это для построения своих собственных систем</td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3.</td><td>TQRLoopBand печатает секцию несколько раз в зависимости от свойства PrintCount - прекрасная вещь для создания бланк форм. </td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">4.</td><td>TQRListWizard позволяет создать отчет на основе списка полей вашей таблицы</td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">5.</td><td>Прекрасная поддержка через email.</td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">6.</td><td>Полные исходные тексты. Программист может просто модифицировать код для локализации на конкретный язык, адоптировать в соответствии с требованиями локального стандарта на интерфейсы, добавить новые свойства и т.д. </td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">7.</td><td>Больше демо проектов, с углубленным качеством, включая примеры использования всех дополнительных свойств версии Pro, и дополнительная техника по написанию собственных функций для анализатора выражений.</td></tr></table><p>Вы можете получить QuickReport Professional путем заполнения формы заказа на нашем web сайте, или у наших дистрибуторов QBS Software Ltd на http://www.qbss.com или у вашего локального продавца Delphi.</p>
<p>Первый отчет</p>
<p>Наилучший путь познать QuickReport это посмотреть его в действии. Данная глава показывает, как создать очень простой отчет. Запустите Дельфи и выполните следующие шаги:</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1</td><td>Выберите File | New Application.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2</td><td>Бросьте TTable компонент на главную форму. </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3</td><td>С помощью Object Inspector установите свойство DatabaseName на 'DBDemos', TableName на&nbsp; 'CUSTOMER.DB' и Active в True.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">4</td><td>Бросьте TQuickRep компонент на главную форму. Размеры и позиция не имеют никакого значения.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">5</td><td>Установите свойство DataSet на 'Table1'. Это ключевой шаг. Генератор отчетов проходит по всем записям в DataSet, только в этом случае Table1, может быть распечатан или просмотрен.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">6</td><td>Если необходимо, то раскройте свойство Bands в Object Inspector путем нажатия на значок +. Установите HasDetail в True. Вы увидите, как появится секция в вашем отчете; смена свойства в действительности создает DetailBand1 объект.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">7</td><td>Бросьте TQRDBText компонент на вновь созданную секцию.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">8</td><td>Смените свойство DataSet на 'Table1' и DataField на 'Company'.</td></tr></table></div>
<p>В данный момент вы должны видеть не что подобное, изображенному на рисунке Figure 1.</p>
<p>Figure 1 &#8211; Setting up a basic report</p>
<p><img src="pic/clip0187.gif" width="217" height="146" border="0" alt="clip0187"></p>
<p>Для проверки, что вы все выполнили правильно, просмотрите отчет, для этого в любом месте TQuickRep щелкните правой кнопкой мышки и выберите Preview из меню. </p>
<p>Если вы видите это, то это значит, что вы создали отчет, который работает в design time. Конечно, не всегда все получается сразу. Если вы получили пустой лист, то проверьте, что выполнили все выше описанные шаги полностью &#8211; обычно забывают установить свойство TTable1.Active в значение True. Подобно если вы видите, что отчет содержит только одну строку &#8211; 'Kauai Dive Shoppe' &#8211; то проблема в том, что вы забыли связать QuickRep1 Dataset с TTable1.</p>
<p>Еще одна частая проблема, что вы не видите кнопок на линейке в форме просмотра. Тут никто не виноват (J): вы должны связаться с производителем операционной системы вашего компьютера и сказать 'DLL Hell'. Specifically, your machine's copy of the common control library (comctrl32.dll) is before 4.72, and needs updating.&nbsp; (От переводчика - замените comctrl32.dll на более свежую).</p>
<p>Вы также можете загрузить самую свежую версию comctrl32.dll с сайта Microsoft http://www.microsoft.com. Но поскольку данный файл входит в комплект поставки Internet Explorer и Windows Service Packs, то вы можете взять его с вашего CD. (В действительности вряд ли подобный баг вас затруднит как разработчика)</p>
<p>Теперь заставим данный отчет работать в откомпилированной программе. Вы должны написать код для вызова TQuickRep.Preview: </p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1</td><td>Разместите клавишу на вашей форме и установите ее свойство в 'Просмотр'</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2</td><td>Дважды щелкните по данной кнопке, для добавления обработчика OnClick. Добавьте одну строчку кода:</td></tr></table></div>
<pre name="code" class="delphi">procedure TForm1.Button1Click(Sender: TObject);
begin
  QuickRep1.Preview;
end;
</pre>
&nbsp;</p>
<p>Теперь запустите программу и нажмите кнопку Просмотр. Должно появится окно просмотра. Если вы желаете напечатать отчет напрямую на принтер по умолчанию, то просто смените слово Preview на слово Print, то есть</p>
<pre name="code" class="delphi">procedure TForm1.Button1Click(Sender: TObject);
begin
  QuickRep1.Print;
end;
</pre>
&nbsp;</p>
<p>В данный момент следует сделать несколько замечаний. В данной тестовой программе компонент TQuickRep расположен на главной форме и, как вы видите это выглядит не совсем хорошо. В реальной программе вы никогда не будете показывать форму содержащую TQuickRep. Вместо этого вы разметите его на другой форме. </p>
<p>Для того, что бы сделать данный пример похожим на настоящее приложение, сделаем еще несколько шагов: </p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1</td><td>Создаем другую форму, назовем ее как Form2 </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2</td><td>Сделаем ее главной формой Project | Options | Main form to Form2 </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3</td><td>Бросим кнопку на Form2 </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">4</td><td>Напишем код в обработчике события кнопки</td></tr></table></div><pre name="code" class="delphi">procedure TForm2.Button1Click(Sender: TObject);
begin
  Form1.QuickRep1.Preview;
end;
</pre>
&nbsp;</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">5</td><td>Откомпилируем проект. Компилятор возмутится, что на Unit1 нет ссылки в Unit2's Uses, и предложит исправить код, соглашаемся. </td></tr></table></div>
<p>Программа должна быть снова откомпилирована и запущена, и теперь выглядит лучше и более 'реалистично'.&nbsp; Конечный пользователь уже не видит компонента TQuickRep. </p>
<p>Выше приведенное сказано для того, что бы в дальнейшем во всех примерах использовалась дополнительная форма, надеюсь вы будете так поступать и в реальных программах. </p>
<p>Компоненты</p>
<p>Все компоненты QuickReport расположены на закладке QReport палитры компонент Delphi. Здесь краткий тур что это такое и как они помогут вам. </p>
<p>TQuickRep. Это наиболее важный компонент, это контейнер для всех других печатных компонент. Выглядит как лист бумаги, на котором вы будете печатать. Его свойство Page позволяет установить размеры бумаги, в то же время свойство Dataset определяет источник данных для отчета.</p>
<p>Заметим, что вместо размещения компонента TQuickRep на одной из форм вы можете добавить TQuickReport модуль в ваш проект:</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">6</td><td>Выберите File | New….</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">7</td><td>Выберите закладку New</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">8</td><td>Выберите Report item (в середине нижней строки)</td></tr></table></div>&nbsp;</p>
<p>TQuickReport немного похож на TDataModule &#8211; это специальный тип формы, которая никогда не показывается пользователю программы. Если вы, то вы можете использовать TQuickReport на псевдо-форме вместо компонента TQuickRep&#8211; никакой разницы в их методах, свойствах и событиях. Но мы рекомендуем, на собственном опыте, что вы разместите компонент TQuickRep на форме: это наиболее подходящее решение. Например, размещение TQuickRep на форме позволяет вам использовать обработчик OnCreate если вы пожелаете добавить некоторые объекты в отчет программным путем. </p>
Секции (Band) компоненты</p>
<p>Это также компонеты-контейнеры, представляющие собой как бы горизонтальный полоски в отчете. Секции могут быть привязаны к физической позиции на странице &#8211; например вверху &#8211; и также могут плавать по странице в при отражение данных из master/detail. Например, может быть несколько записей по продаже для одного заказчика, так что секция содержащая записи об продажах может появляться несколько раз для каждого заказчика отдельно.</p>
<p>TQRSubDetail. Это секция для отражения данных в master/detail связях. Вы также можете сделать ее мастером для другой секции detail, и таким образом создать несколько уровней детализации.</p>
<p>TQRStringsBand. Данный тип секции представляет механизм создания отчетов без использования TDataSet. Для выборки данных используется TStrings контейнер; вместо выборки из базы данных.</p>
<p>TQRBand. Базовый тип секции, который может играть различные роли в зависимости от свойства BandType. Обычно нет нужды бросать TQRBand в отчет. Вместо этого используйте свойство Bands компонента TQuickRep, который и создаст необходимые объекты TQRBand и установить требуемы свойства.</p>
<p>TQRChildBand. Используйте объект TQRChildBand когда вам требуется расширить существующую секцию. Например, вы разместили несколько компонент TQRMemo в секции, и желаете добавить TQRLabel, которая должна быть всегда нижк. Поскольку объекты TQRMemo могут занимать более одной строки, в зависимости от содержимого, то неэффективно размещать метку на самой секции. Вместо этого добавьте объект TQRChildBand, и разместите метку на нем. Наиболее простой путь добавить подобную секцию это дважды щелкнуть по свойству HasChild в Object Inspector.</p>
<p>TQRGroup. Секция которая печатается при смене выражения, обычно при смене значения какого либо поля из базы данных. Данная секция предназначена для группирования одинаковых записей. Например, для печати списка адресов, сгруппированного по полу State Code нужно добавить секцию и установить свойство Expression в значение State Code. При печати отчета адреса будут печататься по штатам.</p>
Печатные (Printable) компоненты</p>
<p>Наиболее подходящий аналог для печатных компонент QuickReport это стандартные компоненты Дельфи размещаемые на формах. Именно эти компоненты обеспечивают действительную печать на бумагу. TQRLabel. Размещает статический текст на странице.</p>
<p>TQRDBText. Эквивалент компоненты TDBText &#8211; используется для отображения содержимого полей базы данных. Похоже на стандартные компоненты, но предназначенные для использования с QuickReport, TQRDBText использует свойство DataSet для указания источника данных. Обычные data-aware компоненты используют свойство DataSource, которое требует использования отдельного компонента TDataSource для связи с набором данных. QuickReport не требуется.</p>
<p>TQRExpr. Используется для отображения 'выражений'. Обычно вы используете для предварительной обработки данных перед печатью. Наилучший путь думать, что это аналог расчетных calculated полей, используемых только в отчете. Например, вы можете объединить все части имени заказчика, поля в таблице customer "Title", "Forename" и "Surname". To Просто установите свойство Expression в</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;Title + " " + Forename + " " + Surname</p>
<p>В реальной жизни, вы вероятно будете использовать более сложное выражение, но данный пример дает представление об использовании. </p>
<p>TQRSysData. Компонент позволяет отображать 'системные данные', подобные номеру текущей страницы в отчете, и текущую дату и/или время. </p>
<p>TQRMemo. Очень похож на стандартный компонент TMemo; используйте для отображения многострочного текста. Как вы правильно предполагаете, данные содержатся в свойстве Lines типа Tstrings.</p>
<p>TQRExprMemo. Композиция TQRExpr и TQRMemo. Вы можете использовать для включения {вычисляемых} выражений в многострочный блок. Это позволяет абсолютно натуральном путем изготавливать адреса, особенно учитывая наличие свойства RemoveBlankLines. Например:</p>
Company : {CompanyName}</p>
Address : {Address1}</p>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {Address2}</p>
Contact : {Contact + ' ' + Phone number}</p>
<p>TQRRichText. Помещает rich text (то есть многострочный текст с RTF форматированием) на страницу. Одно из назначений данного компонента это печать содержимого компоненты TRichEdit control &#8211; просто назначьте свойство TQRRichText.ParentRichEdit.</p>
<p>TQRDBRichText. Это data-aware версия TQRRichText. Используйте для печати форматированного текста из BLOB полей.</p>
<p>TQRShape. Кузина редко используемого компонента TShape control из палитры 'Additional'. В действительности версия QuickReport очень полезна для размещения различного типа рюшечек в отчет, таких как разделительные лини над итогами или группирующие прямоугольники.</p>
<p>TQRImage. Отображает картинку или логотип в отчете. Поддерживает те же самые векторные и битмаповские форматы, что и TImage, и может быть установлено в design time с помощью свойства Picture.</p>
<p>TQRDBImage. data-aware версия, для отображения картинок из BLOB полей базы данных.</p>
&nbsp;</p>
Просмотр и композитные отчеты</p>
<p>TQRCompositeReport. Иногда вам требуется группировать совместно отдельные отчеты в один общий. Например, возможно вам нужно напечатать всех новых заказчиков за последнюю неделю вместе со всеми их заказами. Так как понятие заказчик включает в себя все эти вещи как одно целое, а сточки зрения базы данных вам для это требуется несколько отдельных отчетов. TQuickRep компонент позволяет выполнить эту задачу.</p>
<p>Путь для решения это задачи в использовании TQRCompositeReport компонента. Разместите один на форме. Во первых, вы должны определить обработчик для события OnAddReports, который вызывает метод TQRCompositeReport.Add для добавления всех TQuickRep компонент необходимых для печати. Предположим, что отчеты которые вы желаете объединить находятся на формах с именами RepNewCust, RepOrderSummary и StockReorder, и во всех случаях TQuickRep компонент называется 'Report' (см. главу 'Добавляем TQuickRep' ниже для понимания почему вы должны делать это). Для этого ваш обработчик OnAddReports выглядеть следующим образом</p>
<pre name="code" class="delphi">procedure TForm1.QRCompositeReport1AddReports(
  Sender: TObject);
begin
  QRCompositeReport1.Reports.Add(RepNewCust.Report);
  QRCompositeReport1.Reports.Add(RepOrderSummary.Report);
  QRCompositeReport1.Reports.Add(RepStockReorder.Report);
end;
 
(Если вы не брезгуете использованием оператора with в вашем коде, то вы можете написать так
with QRCompositeReport1.Reports do
begin
  ...
end;
</pre>

<p>и убрать плохо выглядящее повторение QRCompositeReport1.Reports из всех трех строк.)</p>
<p>Теперь вы можете вызывать QRCompositeReport1.Print для печати всех трех отчетов в одном задании, и QRCompositeReport1.Preview to для их просмотра. Имеются также несколько свойств для компонента TQRCompositeReport  которые позволяют управлять размером бумаги и устанавливать заголовок для отчета &#8211; обычно требуется управлять всем для композитного отчета в одном месте.</p>
<p>TQRPreview. Для просмотра отчета перед печатью, все что вам нужно это вызвать TQuickRep.Preview and и стандартное окно просмотра появится. Во многих случаях, вам нужно более полный контроль над окном просмотра. </p>
<p>Компонент TQRPreview позволяет это сделать. Бросьте один на вашу формы, после этого добавьте строку кода в обработчике TQuickRep.OnPreview, компонент работает как основа для размещения ваших органов управления. Если у вас еще больше амбиций или вы желаете сменить просмотр для композитных отчетов, то вы можете зарегистрировать свою собственную форму для просмотра. Смотрите главу 'Создание собственного просмотра'.</p>
&nbsp;</p>
Фильтры</p>
<p>Иногда, вместо печати или просмотра, вам нужно экспортировать данные их вашей базы в другой формат. QuickReport включает в себя три типа фильтров, которые позволяют быстро и просто выполнить данную работу. Просто бросьте компонент экспорта на ту же форму, что и отчет, и список файловых форматов появится в выпадающем списке Save To file диалоге просмотра. Регистрация автоматическая, вам не нужно ничего кодировать! (Но не беспокойтесь, вы можете экспортировать и программно.)</p>
<p>Заметим, что не все печатные компоненты могут быть экспортированы. Обычно, только содержимое следующих компонент появляется в экспортируемых данных: TQRLabel, TQRDBText, TQRExpr, TQRMemo, TQRSysdata and TQRExprMemo.</p>
<p>TQRTextFilter. 'Text' формат: экспортирует отчет, как простой ASCII текст, используются пробелы для разделения полей. </p>
<p>TQRCSVFilter. CSV формат: экспортирует отчет 'Comma Separated Variables'. Используются запятые для разделения полей, данный фильтр вставляет "двойные кавычки " вокруг них, что позволяет использовать запятые внутри полей. Данный формат очень легко импортируется в различного рода электронные таблицы, такие как Microsoft Excel. Тем не менее, компонент имеет свойство Separator, что позволяет использовать и другие разделители полей. По умолчанию его значение ',' запятая, но это может быть изменено в соответствии с вашими требованиями.</p>
<p>TQRHTMLFilter. HTML формат: экспортирует отчет в HyperText Markup Language, который используется в web браузерах, некоторых постовых клиентах, справочных системах и во многих других местах. </p>
<p>Имеется возможность экспортировать отчет из кода. Следующий пример показывает как использовать HTML фильтр.</p>
<p>quickrep1.ExportToFilter(</p>
<p> TQRHTMLDocumentFilter.Create('c:\report.txt'));</p>
<p>Для использования фильтров Text или CSV данных образом, используйте тот же самый вызов ExportToFilter но только укажите соответствующий фильтр как TQRAsciiExportFilter или TQRCommaSeparatedFilter.</p>
&nbsp;</p>
Графики </p>
<p>TQRChart это версия TChart адаптированная под QuickReport. Позволяет добавлять сложные графики к вашим отчетам. TQRChart используется тем же самым образом, что и стандартный компонент Tchart &#8211; двойной щелчок вызывает редактор свойств. Подробности смотреть в документации на TeeChart.</p>
&nbsp;</p>
Несовместимость версий</p>
<p>В связи с особенностью наших компонент, некоторые версии TeeChart не совсем совместимы с QuickReport, и компонент TQRChart и TeeChart могут быть загружены во время апгрейда QuickReport. Например, во время написания Delphi 3 версии QuickReport 3 (или выше) не все работало с TeeChart, поскольку версия of TeeChart которая поступала с Delphi 3 был кодирована под версию QuickReport 2. Для решения проблемы можно загрузить (свободно) TeeChart 4 (evaluation version J) с сайта TeeMach http://www.teemach.com/.&nbsp; </p>
<p>Данная редакция расширяет компонент Decision Cube из Client/Sever и Enterprise Editions редакций Delphi &#8211; это зависит от TeeChart. В данный момент нет пути использовать Delphi 3 Decision Cube вместе с QuickReport 3 и TeeChart. </p>
<p>Мы извиняемся за подобную ситуацию. С тех пор как мы разрешили другим сторонам писать для QR, мы не можем автономно вносить исправления в их код. Если вы имеете проблемы после апгрейда QuickReport, пожалуйста проверьте сайты http://www.qusoft.no/ и TeeMach's для получения последней информации.</p>
<p>Создание отчетов</p>
<p>Первым шагом создания отчета, является создание формы для размещения вашего компонента TQuickRep. Мы называем подобную форму, как 'форма отчета поскольку это просто контейнер для хранения компонент отчета и она никогда не показывается конечному пользователю. Хорошим тоном является применение некоторых соглашений по именованию подобных форм, так что бы их было просто идентифицировать в project manager и при просмотре каталога файлов. Например, вы можете использовать префикс для вех отчетов как 'rep' или 'rp'. Вы можете использовать подобную схему для всех форм и модулей данных. </p>
Добавляем TQuickRep</p>
<p>Следующий шаг, размещение TQuickRep на форме. Другой соглашение именуйте все компоненты TQuickRep, как 'Report', вы сможете ссылаться на них как repCustomerListing.Report, repSalesListing.Report.</p>
Свойства Units и Zoom </p>
<p>После размещения компонента TQuickRep на форме вы увидите сетку для позиционирования различных компонент в отчете. Сетка показывается в текущих единицах измерения QuickReport. Выбор соответствующей единицы измерения производится через свойство TQuickRep.Units в инспекторе объектов. Сетка изменяется в соответствии с единицами измерения.</p>
<p>&nbsp;</p>
<p>При установке свойства Units в 'MM', сетка отображается с шагом в 10mm; при установке в 'Inches' с интервалом в один дюйм. Используя сетку, вы можете получить очень точное размещение элементов, и изменение размеров с точностью 0.01" или 0.01mm.</p>
<p>Обычно ваш экран слишком мал, что бы отобразить все компоненты TQuickRep, поскольку их размер базируется на действительных размерах выбранной бумаги. Для просмотра всего отчета измените свойство на 50% или меньше. Изменение свойства zoom заставляет TQuickRep и все печатные&nbsp; компоненты, содержащие в нем пере рисоваться в соответствии со шкалой. Данное свойство может использоваться и для увеличения, с целью более точного размещения важных компонент в отчете.</p>
Размер страницы и границы</p>
<p>Вы можете очень точно указать параметры страницы, развернув список суб свойств свойства Page компоненты TQuickRep. Двойной щелчок на значке + слева от 'Page' в инспекторе объектов. Вы увидите все опции управляющие страницей.</p>
<p>Значения указываются в соответствии со свойством Units, в данном случае в дюймах. Границы видны в как синии линии в компоненте TQuickRep. Все секции изменяют свои размеры в соответствии с границами. </p>
<p>Не все принтеры поддерживают режим Custom для размеров бумаги. В данном случае вы должны выбрать 'Custom paper size' в диалоге драйвере принтера (доступно через панель управления Windows) и определить размер там. Устанавливает размер для принтера по умолчанию и окончательно установите свойство TQuickRep.Page.PaperSize в состояние Default. Ваш пользовательский размер будет доступен в runtime. </p>
<p>Альтернативно и возможно более безопасно использовать следующий больший размер, и установить границы для установки области печати в пользовательской области.</p>
Выбор шрифта</p>
<p>Как вы уже знаете, вы можете установить шрифт по умолчанию для всего отчета в свойстве TQuickRep.Font. Двойной щелчок по свойству вызывает стандартный диалог выбора шрифтов. </p>
<p>Шрифты указанные здесь - это системные шрифты Windows, True Type шрифты и PostScript fonts (если установлен Adobe TypeManager). Вы можете использовать любую комбинацию шрифтов в отчете, но мы рекомендуем использовать только TrueType или PostScript шрифты, если вы желаете разрешить пользователю пользоваться просмотром. Системные шрифты не масштабируются во время просмотра.</p>
<p>Некоторые матричные принтеры печатают много быстрее если вы используете принтерные шрифты (шрифты встроенные в принтере). Такие шрифты не указываются в диалоге, но могут быть установлены программно:</p>
<p>repCustomerListing.Report.Font.Name := 'CG TIMES';</p>
<p>Читабельность вашего отчета очень зависит от выбора шрифтов. Вы должны подойти со всей внимательностью к этому выбору. Использование большого количество различных шрифтов, цветов может сделать чтение вашего отчета неприятной задачей.</p>
Заголовок и описание</p>
<p>Компонент TQuickRep имеет свойства Title и Description, которые идентифицируют и описывают ваш отчет. Данные свойства только для вашего личного использования, что бы вы могли делать выбор отчета в соответствующей процедуре. Например, вы можете иметь отдельное меню для выбора отчетов из списка по его заголовку (title) и показывать его описание когда пользователь производит выбор отчета. Данную методику можно посмотреть в демонстрационном проекте QuickReport. </p>
<p>Свойство Title может быть распечатано в отчете с помощью TQRSysData компоненты. </p>
Свойство Functions</p>
<p>Свойство Functions компоненты TQuickRep разрешает вам установить константы и функции, которые могут быть использованы в выражениях TQRExpr, TQRExprMemo и TQRGroup. Двойной щелчок по клавише '…'&nbsp; в инспекторе объектов, вызывает специальный редактор свойств:</p>
<p>Используйте данный диалог, и построитель выражений, для определения констант которые вам требуются в выражениях. Например, вы видите в Figure 8 определение константы PI как 3.14159265358979. Другие функции, которые вы видите здесь, '…' заранее предопределены.</p>
Работа с секциями</p>
<p>QuickReport является генератором работающий с секциями (band). Если вы незнакомы с данным понятием, то думайте об секциях как о маленьких кусочках бумаги (шаблонах), которые размещаются горизонтально на бумаге и заполняются данными. Различные шаблоны копируются в различные места страницы/отчета. Печатные компоненты TQRLabel, TQRDBText и другие, разработаны для размещения на секциях. Размещение данных компонент на прямую на отчет не предусмотрено.</p>
<p>Простейшим путем добавления секций в отчет является использование свойство TQuickRep.Bands в инспекторе объектов. Щелкните по значку '+' слева от надписи 'Bands' для развертывания списка секций</p>
<p>&nbsp;</p>
<p>Инспектор объектов показывает, используется данная секция или нет, и вы можете добавить или удалить любую секцию просто установив соответствующее свойство. Секции созданные данным путем имеют имена, описывающие их назначение: DetailBand1, PageHeaderBand1 и т.д. Свойство BandType устанавливается автоматически.</p>
<p>Хотя и возможно добавление секций вручную и установке BandType в rbSubDetail или rbGroupHeader, но это не рекомендуется. Данные секции предназначены для использования только с секциями TQRSubDetail и TQRGroup. Использование их где-либо еще может дать непредсказуемый результат.</p>
<p>Вы также можете добавить секции путем выбора компоненты TQRBand из палитры и размещения их в отчете. Заметим, что в этом случае вы должны сами побеспокоиться об установке свойства BandType, и вы также должны дать секции подходящее имя. Свойство Bands контейнера TQuickRep преобразуется автоматически для отражения секций добавленных в отчет данным путем. </p>
<p>Здесь список простых секций, которые вы можете добавить в отчет:</p>
<p>Band type &nbsp; &nbsp; &nbsp; &nbsp;Purpose &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Page Header &nbsp; &nbsp; &nbsp; &nbsp;Первая секция, обычно печатается на каждой странице. Печать на первой странице определяется свойством Options.FirstPageHeader. Значение по умолчанию: печатать на первой странице. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Title &nbsp; &nbsp; &nbsp; &nbsp;Секция title - первая секция, которая печатается в отчете (после заголовка первой страницы, если есть). Часто используется для печати титульного листа отчета, критериев выбора данных, Даты и времени создания и т.д. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Column Header &nbsp; &nbsp; &nbsp; &nbsp;Секция заголовков, печатается вверху регулярного отчета, на каждой странице. После заголовка страницы (и после Title на первой странице). В много колоночном отчете , печатается для каждой колонки. Часто используется для печати наименований полей. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Detail &nbsp; &nbsp; &nbsp; &nbsp;Секция для печати каждой записи (строки) вашего набора данных. Это конечно наиболее важная секция в отчете и которая занимает основное место в вашем отчете. Вы должны поместить data-aware печатные компоненты, такие как TQRDBText на эту секцию. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Summary &nbsp; &nbsp; &nbsp; &nbsp;После печати всех секций detail, вы можете отпечатать суммарные итоги в данной секции.. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Page Footer &nbsp; &nbsp; &nbsp; &nbsp;Последняя секция на каждой странице. Печать на последней странице определяется свойством Options.LastPageFooter.. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Как только вы добавляете новые секции в отчет, вы видите как они позиционируются в порядке действительной печати. Вы видите, что секция Page Header помещается вверх, следующая за ней секция Title, column header и так далее.</p>
<p>&nbsp;</p>
<p>Тип каждой секции печатается маленькими буквами в левом нижнем углу. Это позволяет вам идентифицировать их в отчете. Данный текст не попадает в финальный отчет.</p>
<p>Секции появляющиеся в отчете компоненты TQuickRep показываются в том порядке, в каком они будут при печати. Это помогает понять как это будет отпечатано. Наиболее частое использование секций показано на Figure 10, но это становится весьма сложным, когда вы начинаете печатать суб-секции и групировавать.</p>
Размеры секций</p>
<p>Секции получают их горизонтальный размер от компоненты TQuickRep. Их свойства Size.Width используются только как read only; Попытка записи в них других значений игнорируется. Для одно-колоночного отчета, ширина всех секций устанавливается равной ширине страницы минус левая и правая границы. Во многоколоночном отчете, ширина секции (Column Header, Detail, Sub Detail, Group Header and Group Footer) подстраивается под доступную ширину отдельной колонки</p>
<p>Тем не менее вы можете изменять вертикальный размер секции. Выберите секцию и измените размер с помощью мышки или с помощью&nbsp; изменения свойства Size.Height.</p>
Включение и выключение секций</p>
<p>Иногда вы не желаете запретить печать той или другой секции. Это может быть сделано или в design time или в run time, установкой свойства TQRBand.Enabled в False. </p>
<p>Во время генерации отчета вы также можете временно запретить печать секции в обработчике события BeforePrint. Данный обработчик имеет параметр PrintBand, который вы можете установить в False для запрета печати секции &#8211; но только на один раз. Данное свойство весьма удобно для организации простой фильтрации:</p>
<pre name="code" class="delphi">procedure TrepCusList.RepDetailBeforePrint
 (Sender: TQRCustomBand;
  var PrintBand: Boolean);
begin
  PrintBand := CustTableTotalSales &gt; 3000000;
end;
</pre>
<p id="note">Примечание</p>
<p>Когда PrintBand устанавливается в False для detail секции, значения для данной записи не включаются в расчет агрегатных TQRExr функций, например функция SUM. Данное поведение отличается между версиями QuickReport 2 и QuickReport 3.</p>
<p>Если вы выключите секцию Page Footer, следствием будет появление пустого пространства внизу каждой страницы &#8211; секция Detail не использует данное пространство, QuickReport не проверяет размер страницы каждый раз. Так что если вы смените свойство Enabled секции Page Footer, то вызовите метод ResetPageFooterSize для обновления информации.</p>
Группы</p>
<p>Группы позволяют вам генерировать дополнительные секции между группами записей. Например, если вы печатаете список из адресной книги, вы может быть желаете группировать все записи у которых первая буква имени одинаковая, и печатать большую букву между группами &#8211; в действительности это то, что мы сейчас сделаем в примере.</p>
<p>Для создания группы: </p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1</td><td>Создайте простой отчет, как это описано в 'Первый отчет'. </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2</td><td>Установите свойство IndexName компоненты TTable в 'ByCompany'. </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3</td><td>Бросьте компонент TQRGroup на TQuickRep объект, появится новая секция. Данная секция будет заголовком для группы (group header). Каждый раз, когда будет начинаться новая группа, данная секция будет напечатана. </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">4</td><td>Установите свойство Expression в </td></tr></table></div>COPY(Table1.Company,1,1)</p>
Это извлечет первую букву из поля 'Company'.</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">5</td><td>Бросьте компонент TQRExpr на данную секцию. Установите свойство Expression в тоже самое значение</td></tr></table></div>COPY(Table1.Company, 1, 1)</p>
В дополнение вы также должны добавить секцию group footer. Хотя нам здесь это и не требуется, но мы сделаем одну для практики. </p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">6</td><td>Выберите компонент TQRBand на палитре и бросьте его в отчет. Переименуйте его в FooterBand1.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">7</td><td>Щелкните по секции the group еще раз. Установите свойство TQRGroup.FooterBand в FooterBand1. </td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">8</td><td>Бросьте компонент TQRLabel на footer band. Установите свойство Caption в 'FOOTER'. </td></tr></table></div>&nbsp;</p>
<p>Просмотрите отчет, или путем запуска программы, или просто выбрав правой кнопкой пункт Preview</p>
<p>Как планировалось, отчет показывает список всех компаний в алфавитном порядке, каждая группа имеет заголовок в виде буквы.</p>
Мастер/детайл отчеты </p>
<p>Часто требуется отчет типа master/detail &#8211; это когда вы извлекаете данные из двух наборов данных, объединенных связью master/detail. QuickReport позволяет вам включать одну или несколько таких связей в отчет, с помощью компоненты TQRSubDetail. </p>
<p>В приведенном примере a master/detail отчета выводится список всех заказов по каждому заказчику в базе данных. Здесь краткий пример:</p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">1</td><td>Создайте группированный отчет, как описано в предыдущей главе.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">2</td><td>Бросьте компонент TDataSource на форму, и назначьте его свойство DataSet равным 'Table1'.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">3</td><td>Бросьте новый компонент TTable на форму. Установите его свойство DatabaseName в 'DBDemos', TableName в 'ORDERS.DB', IndexName в 'CustNo', MasterSource в 'DataSource1', MasterFields в 'CustNo' и Active в True. Два компонента TTable сейчас имеют связь master/detail.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">4</td><td>Бросьте компонент TQRSubDetail на существующий TQuickRep, где это появится как новая секция. Заметим, что свойство Master установилось в QuickRep1. Связь master/detail между двумя TTable объектами отразилось между объектами отчета и секциями.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">5</td><td>Установите свойство DataSet компоненты TQRSubDetail в 'Table2'. Компонент TQRSubDetail будет выводить все записи через его DataSet для каждого изменения Dataset мастера.</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 38px;"><table border="0" cellpadding="0" cellspacing="0" style="line-height: normal;"><tr><td width="24">6</td><td>Бросьте три компонента TQRDBText на секцию sub detail. Установите свойство DataSet в 'Table2', и установите свойство DataField в 'OrderNo', 'SaleDate' и 'ItemsTotal'.</td></tr></table></div>&nbsp;</p>
<p>&nbsp;</p>
<p>Теперь посмотрим отчет. Результат должен иметь список заказов ниже имени каждого заказчика. Заметим, что формат дат и денежных полей зависит от установок в Windows. </p>
<p>Обзор печатных (printable) компонент</p>
<p>В данный момент, вы уже имеете представление об печатных компонентах QuickReport's &#8211; использования их как обычных органов управления. Тем не менее есть несколько специфичных для QuickReport аспектов.</p>
Текстовые компоненты</p>
<p>Текстовые печатные компоненты QuickReport's &#8211; TQRLabel, TQRDBText, TQRExpr, TQRSysData, TQRMemo, TQRExprMemo, TQRRichText и TQRDBRichText &#8211; используют несколько общих свойств, которые они наследуют: </p>
<p>Property &nbsp; &nbsp; &nbsp; &nbsp;Purpose &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>AlignToBand &nbsp; &nbsp; &nbsp; &nbsp;По умолчанию все компоненты печатаются в позиции установленной во время проектирования. Но иногда более практично по вертикальным углам секции, на которой они размещены. Если свойство AlignToBand установлено в True, то компонент выравнивается относительно секции, в которой он размещен.. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>AutoSize &nbsp; &nbsp; &nbsp; &nbsp;При установке этого свойства в True компонент расширяется по горизонтали, что разместить весь текст. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>AutoStretch &nbsp; &nbsp; &nbsp; &nbsp;Если свойство AutoStretch и WordWrap оба установлены в True, компонент может расширяться по вертикали, что бы разместить весь текст. Когда компонент расширяется подобным образом, то расширяется и секция, на которой он, определяется свойством CanExpand. При необходимости секция может расширяться на несколько страниц. Заметим, что если компонент расширяется, то это не перемещает другие компоненты вниз. Если имеются другие компоненты, которые зависят от размеров расширяемого компонента, то такие компоненты должны размещаться секции child.&nbsp; Заметим, что данное свойство не может быть использовано для компонент размещенных на любой секции внизу страницы, типично это page footer, но также любые секции, у которых установлено свойство AlignToBottom в True. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Frame &nbsp; &nbsp; &nbsp; &nbsp;Все текстовые компоненты могут показывать видимую рамку вокруг себя.  &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Size &nbsp; &nbsp; &nbsp; &nbsp;Все печатные компоненты имеют свойство Size. Если свойство AutoSize установлено в False вы можете использовать данное свойство для установки точного размера компонента. Данное свойство содержит также позицию компонента относительно секции.  &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>WordWrap &nbsp; &nbsp; &nbsp; &nbsp;Если свойство WordWrap установлен True текст может расширяться на несколько строк. &nbsp; &nbsp; &nbsp; &nbsp;</p>
Форматирование полей</p>
<p>Компонент TQRDBText использует опции форматирования определенные в для поля, к которому он подключен. Иногда, вам нужно отображать текст иначе, в этом случае вы можете использовать свойство Mask компоненты TQRDBText. В этом поле вы можете вводить те же самые значения, как это определено в функции FormatFloat function (для цифровых полей) и в функции FormatDateTime (для полей типа date и time) &#8211; в действительности, QuickReport сам вызывает эти функции. Покажем на примере, условимся, что вы хотите напечатать цифровое значение с двумя знаками после запятой, и в качестве разделителя тысяч - запятую, и отрицательный в круглых скобках. То маска должна выглядеть следующим образом #,##0.00;(#,##0.00) и которое напечатает для значений 1234 и -1234.5 следующий вывод 1,234.00 и (1,234.50) соответственно.</p>
<p>Сверьтесь с Delphi хелпом по функциям FormatFloat и FormatDateTime.</p>
<p>Для форматирования поля используйте свойство Mask. Маска работает по разному для разных типов полей. </p>
Использование выражений</p>
<p>QuickReport включает расширенный анализатор выражений, используемый компонентами TQRExpr, TQRExprMemo и TQRGroup. Выражения могут быть использованы для объединения и манипулирования полями баз данных, и для выполнения различного форматирования. Их синтаксис подобен синтаксису Object Pascal: выражения могут быть логического, с плавающей запятой, целого типа или строкового типа. Заметим, что поля дат и времени преобразовываются в строки, а BLOB и memo поля не поддерживаются в выражениях. </p>
<p>Анализатор выражений использует следующий набор операторов:</p>
<p>&nbsp;</p>
<p>Operators &nbsp; &nbsp; &nbsp; &nbsp;Function &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>+ &nbsp; &nbsp; &nbsp; &nbsp;Сложение и объединение строк &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>- * / &nbsp; &nbsp; &nbsp; &nbsp;Вычитание, умножение и деление &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>() &nbsp; &nbsp; &nbsp; &nbsp;Группирование &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>And Or Not &nbsp; &nbsp; &nbsp; &nbsp;Логические операторы &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>= &lt; &gt;&nbsp; &lt;= &gt;= &lt;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Операции сравнения &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>И набор стандартных функций:</p>
<p>&nbsp;</p>
<p>Function &nbsp; &nbsp; &nbsp; &nbsp;Description &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>AVERAGE(EXPR) &nbsp; &nbsp; &nbsp; &nbsp;Агрегатные функции. Среднее значение выражения &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>COPY(STR,S,L) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает субстроку, начиная с позиции S размером L &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>COUNT &nbsp; &nbsp; &nbsp; &nbsp;Агрегатная функция, возвращает количество итераций секции Master. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>DATE &nbsp; &nbsp; &nbsp; &nbsp;Возвращает текущую дату в виде строки &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>DIV(X, Y) &nbsp; &nbsp; &nbsp; &nbsp;Целочисленное деление X на Y &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>FALSE &nbsp; &nbsp; &nbsp; &nbsp;Логическое значение ЛОЖЬ False &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>FORMATNUMERIC(F, N) &nbsp; &nbsp; &nbsp; &nbsp;Форматирует номер N используя маску F. Маска соответствует функции FormatFloat. &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>FRAC(NUM) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает дробную часть числа NUM &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>IF(EXPR, R1, R2) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает или R1 или R2 в зависимости от логического значения EXPR &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>INT(NUM) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает целую часть числа NUM &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>LOWER(STR) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает строку из малых букв &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>MAX(EXPR) &nbsp; &nbsp; &nbsp; &nbsp;Агрегатная функция. Возвращает максимальное значение выражения EXPR &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>MIN(EXPR) &nbsp; &nbsp; &nbsp; &nbsp;Агрегатная функция. Возвращает минимальное значение выражения EXPR  &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>PRETTY(STR) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает строку, у которой первая буква заглавная, а остальные прописные  &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>SQRT(NUM) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает квадратный корень числа NUM &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>STR(NUM) &nbsp; &nbsp; &nbsp; &nbsp;Превращает число в строку &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>SUM(EXPR) &nbsp; &nbsp; &nbsp; &nbsp;Агрегатная функция. Возвращает сумму выражения EXPR &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>TIME &nbsp; &nbsp; &nbsp; &nbsp;Возвращает текущее время в виде строки &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>TRUE &nbsp; &nbsp; &nbsp; &nbsp;Логическое значение ИСТИНА &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>TYPEOF(EXPR) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает тип выражения в виде строки. Например 'BOOLEAN' &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>UPPER(STR) &nbsp; &nbsp; &nbsp; &nbsp;Возвращает строку из больших букв &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Если ваше выражение включает агрегатную функцию, например SUM или COUNT вы должны связать свойство Master с компонентом TQuickRep или TQRSubDetail. Для простого отчета это ваш компонент TQuickRep, но в сложных отчетах это может быть любой набор данных. Выражение пересчитывается каждый раз, как указатель master изменяется. </p>
<p>Свойство ResetAfterPrint также используется при работе с агрегатными функциями, и позволяет вам создавать, например групповые итоги как изменяемые во время отчета.</p>
Построитель выражений</p>
<p>Для упрощения создания выражения, QuickReport включает специальный редактор свойств, который доступен по нажатию на клавишу '…'. </p>
<p>&nbsp;</p>
<p>Построитель выражений позволяет вам разрабатывать ваше выражение путем выбора функций и имен полей из списка, что упрощает процесс и позволяет избежать типографических ошибок в идентификаторах полей. Также можно вызвать специальный диалог для выбора аргументов функций. </p>
<p>Создание собственного просмотра</p>
<p>Как мы отмечали ранее, в главе 'Просмотр и композитные отчеты', что имеется возможность создать свой собственный механизм просмотра. Теперь самое время показать, как это сделать.</p>
<p>Первым шагом создание собственного просмотра - это наследование от TQRPreviewInterface, подобно этому:</p>
<pre name="code" class="delphi">
// use QRPrntr to get TQRPreviewInterface
 
TQRCustomPreviewInterface = class(TQRPreviewInterface)
  public
    function Show(AQRPrinter : TQRPrinter) 
      : TWinControl; override;
    function ShowModal(AQRPrinter : TQRPrinter)
      : TWinControl; override;
  end;
</pre>
<p>Заметим, что это интерфейсный класс interface &#8211; это обрабатывает только несколько функций. Эти две функции предназначены для отображения в модальной и не модальной форме. </p>
<p>Предположим, что форма просмотра называется TCustPreview. Затем реализуем методы TQRCustomPreviewInterface, которые выглядят так:</p>
<pre name="code" class="delphi">function TQRCustomPreviewInterface.Show(
  AQRPrinter: TQRPrinter): TWinControl;
var
  frm : TCustPreview;
begin
  frm := TCustPreview.Create(Application, AQRPrinter);
  frm.Show; 
  Result := frm;
end;
 
function TQRCustomPreviewInterface.ShowModal(
  AQRPrinter: TQRPrinter): TWinControl;
var
  frm : TCustPreview;
begin
  frm := TCustPreview.Create(Application, AQRPrinter);
  frm.ShowModal; 
  Result := frm;
end;
</pre>
<p>Для регистрации альтернативного просмотра&nbsp; мы должны вызвать функцию RegisterPreviewClass, из QRPrntr модуля. Вызов выглядит следующим образом:</p>
<p>RegisterPreviewClass(TQRCustomPreviewInterface);</p>
<p>Теперь мы сделали простой код и можем построить форму просмотра. Здесь только минимум; простой компонент TQRPreview на форме</p>
<p>Когда вы будете создавать реальный просмотровщик для ваших приложений, то вы добавите кнопки для вызова метода TQRPreview.Zoom и других возможностей.</p>
<p>Для поддержки механизм просмотра, я написал немного больше кода. Здесь объявление TCustPreview. Заметим, что я добавил новый конструктор, который позволяет принимать в качестве аргумента the TQRPrinter передаваемый методами Show и ShowModal интерфейсного класса. Delphi генерирует предупредительное сообщение, что новый конструктор скрывает оригинал. В данном случае это правильно и написал в классе </p>
<p>{$WARNINGS ON} ... {$WARNINGS OFF}</p>
<p>для подавления предупреждений компилятора.</p>
<pre name="code" class="delphi">{$WARNINGS OFF}
  TCustPreview = class(TForm)
    QRPreview1: TQRPreview;
    procedure CustPreviewClose(Sender: TObject; 
                               var Action: TCloseAction);
  private
    { Private declarations }
    fQRPrinter : TQRPrinter;
  public
    { Public declarations }
    constructor Create(AOwner : TComponent; 
                       AQRPrinter : TQRPrinter); virtual;
  end;
{$WARNINGS ON}
</pre>
<p>Окончательно, здесь реализация класса. Заметим, что код очистки расположен в обработчике OnClose. Если вы не вызовете метод ClosePreview здесь, вы будете иметь утечку памяти. (QuickReport 2 должны знать это новое требование. Вы должны модифицировать ваши существующие формы просмотра, когда будете сортировать их в QuickReport 3.)</p>
<pre name="code" class="delphi">constructor TCustPreview.Create(AOwner: TComponent;
  AQRPrinter: TQRPrinter);
begin
  inherited Create(AOwner);
  fQRPrinter := AQRPrinter;
  QRPreview1.QRPrinter := AQRPrinter;
end;
 
procedure TCustPreview.CustPreviewClose(Sender: TObject;
  var Action: TCloseAction);
begin
  fQRPrinter.ClosePreview(Self);
  Action := caFree;
end;
</pre>

<p>Дополнительные ресурсы</p>
<p>Имеется много других ресурсов, которые помогут вам в применении QuickReport в ваших приложениях.</p>
<p>Help files. QuickReport хелп фалы инсталлируются и интегрируются с Delphi хелп системой. Как положено это чувствительно к контексту, также имеет руководство пользователя и база знаний. Но они не появляются в главном оглавлении справочной системы.</p>
<p>Demo applications. Вы можете найти здесь </p>
<p>Program Files\Borland\Delphi5\Demos </p>
<p>Проект Quickrpt\Qr3\qr3demo.dpr содержит множество примеров. Начните здесь если вы желаете поглубже изучить различные свойства QuickReport, например фильтры экспорта. Также посмотрите проект Db\Mastapp\mastapp.dpr, который содержит прекрасный пример использования QuickReport интегрированный в большой проект.</p>
<p>Templates and wizards. Стандартный репозиторий Delphi содержит шаблоны построения отчетов Master/detail, ярлыков и списков, плюс помощник построения отчетов (report building wizard). Выберите File | New из Delphi и смотрите закладки Forms и Business.</p>
<p>Website. Наш сайт http://www.qusoft.com Пожалуйста приходите и поищите больше примеров, апдейтов, советов и дополнений. </p>
<p id="note">Примечание от Vit</p>
<p>Публикуется с сокращениями</p>
</div>

<div id="footer">
<hr/>
<p>Материал из DRKB Library<br/>Разработка и поддержка &mdash; <a title="DRKB на GitHub" href="https://github.com/quadroid/drkb" target="_blank">Quadr0</a></p>
</div>
</div>
</body>
</html>
