<!DOCTYPE html>
<html>
<head>
  <title>Практически все о взломе CD</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link type="text/css" href="css/css.css" rel="stylesheet"/>
  <link type="text/css" href="css/sh.css" rel="stylesheet"/>
  <script language="javascript" src="js/shInit.js"></script>
  <script language="javascript" src="js/shCore.js"></script>
  <script language="javascript" src="js/shBrushDelphi.js"></script>
  <script language="javascript" src="js/shBrushSql.js"></script>
</head>
<body>
<div id="layout">
<div id="header">
  <a title="DRKB Library" href="../splash.html"><div id="logo"></div></a>
</div>
<div id="content">
<div id="explorer">DRKB Explorer</div>
  <h1 id="title">Практически все о взломе CD</h1>
<div id="date">01.01.2010</div>

<p>Вступление </p>
<p>Наконец, я решился на написание этой статьи, идея пришла давно, но полностью систематизировать решился только сегодня. Сегодня мы не будем рассматривать конкретного взлома. На это есть две причины: </p>
<p>1) У меня начал глючить CD-ROM, пора менять</p>
<p>2) Статья получилась бы слишком длинной </p>
<p>В принципе вторая причина меня волнует мало, но первая встала доста- точно остро. </p>
<p>Хотя сдесь и будет в основном теоретический материал, о способах за- щиты от копирования с CD и методах устранения такой нехорошести, но я буду приводить и примеры игр, к сожалению, многое ломается на ходу и не обременяешь себя запоминанием, поэтому примеры игры в основном одни и те же. </p>
<p>Принципы и методы защиты </p>
<p>Сейчас я постараюсь написать все, когда либо встреченные методы за- щиты: </p>
<p>1) Проверка на наличие диска</p>
<p>2) Проверка на метку тома</p>
<p>3) Проверка на наличие места</p>
<p>5) Проверка на наличие файла и его аттрибуты</p>
<p>5) Проверка на запись файла</p>
<p>6) Другие виды проверки</p>
<p>7) Некоторые общие моменты </p>
<p>1) Проверка на наличие диска </p>
<p>Я разделяю эти проверки на два класса: </p>
<p>1) Функцией GetDriveTypeA </p>
<p>Теория: Функция GetDriveTypeA возвращает в eax тип диска по его имени Вот список возвращаемых значений. </p>
<p>0 -- - Невозможно определить тип</p>
<p>1 -- - Диск не найден</p>
<p>2 DRIVE_REMOVABLE - Гибкий (возможна замена)</p>
<p>3 DRIVE_FIXED - Жесткий (замена невозможна)</p>
<p>4 DRIVE_REMOTE - Сетевой диск</p>
<p>5 DRIVE_CDROM - CD-ROM</p>
<p>6 DRIVE_RAMDISK - RAM - Диск </p>
<p>Как часто встречается: </p>
<p>Такая проверка стоит на абсолютном большинстве ИГР. </p>
<p>Методы взлома: </p>
<p>1) Используя Soft-Ice/TRW2000 поставить бряк на эту функцию командой bpx GetDriveTypeA и если после выхода в вызывающую программу, недалеко стоит cmp eax, 00000005, то следует 5 исправить на 3, т.е. программа будет искать не CD-ROM, а жесткий диск. </p>
<p>2) Дизассемблировать перейти к месту вызова функции, посмотреть, есть ли сравнение. Это несколько модернизированный вариант пункта 1. </p>
<p>3) На эту идею я натолкнулся в статье Vadim M. "Как отучить игры от про- верки CD-ROM (на примере Hellfire)". Краткое описание: поскольку функция GetDriveTypeA вызывается из kernel32.dll будем править там, смысл, чтобы все жесткие диски в системе были бы как CD-ROM'ы, этого легко достичь пере- правив результат возвращаеммый функцией с 3 на 5, правдо это не всегда про- ходит. Эту статью можно увидеть на www.reversing.net </p>
<p>Примеры игр: </p>
<p>Project IGI, Deadly Dozen, and many others </p>
<p>2) Запись имя диска в реестр или файл </p>
<p>Как часто встречается: </p>
<p>Достаточно часто </p>
<p>Метод взлома: </p>
<p>Я использую такой метод, т.к. программа где-то сохранила имя CD-ROM'a, значит, если мы изменим имя, то программа откажется запускаться, даже если диск будет торчать в CDюке. Изменяем имя и если запускаться перестанет, то ищем с помощью RegMon и FileMon, куда программа его запрятала. </p>
<p>Примеры игр: </p>
<p>Shockman (Шокмэн), записывала в файл WINDOWS\facked.ini </p>
<p>2) Проверка на метку тома </p>
<p>Теория: Метка тома проверяется с помощи функции GetVolumeInformation, если эта функция вызывается, то почти однозначный вывод проверка метки тома. Функция очень часто используется с категорией 1. </p>
<p>Как часто встречается: </p>
<p>Очень часто </p>
<p>Методы взлома: </p>
<p>1) Используя Soft-Ice/TRW2000 поставить бряк на эту функцию командой bpx GetVolumeInformation. После этой процедуры скорее всего идет процедура сравнения правильной метки с вашей. После процедуры переправить переход. </p>
<p>2) Дизассемблировать перейти к месту вызова функции, посмотреть, есть ли сравнение и т.д.. Это несколько модернизированный вариант пункта 1. </p>
<p>3) Если категорию 1 вы уже правили. Посмотреть метку тома на компакт-ди- ске, и установить такую же на любом жестком диске. </p>
<p>4) Если категорию 1 не правили. Берем любой свой компакт с длинной метки тома меньшей, либо равной длинне метки на ломаемом компакте. Ищем в испол- няемых файлах программы, настоящую метку и заменяем ее нашей. Вывод если Вы вставляете свой компакт, игра думает, что это ее родной. </p>
<p>Примеры игр: </p>
<p>Deadly Dozen </p>
<p>3) Проверка на наличие места </p>
<p>Теория: Наличие свободного места на диске проверяется функцией GetDiskFreeSpace. Функция вызывается для того, чтобы проверить что это за диск, ведь на CD свободного места нет. </p>
<p>Как часто встречается: </p>
<p>Бывает </p>
<p>Методы взлома: </p>
<p>Аналогичны методам 1 и 2 из 1 и 2 категории, только на другую функцию. </p>
<p>Примеры игр: </p>
<p>Была какая-то, но не помню названия. </p>
<p>4) Проверка на наличие файла и его аттрибуты </p>
<p>Теория: Один из распространившихся в последнее время приемчиков, часто это используется для проверки видео. Которое не копируется на ЖД. В основном используются такие функции: </p>
<p>GetFileAttributesA - Проверка аттрибутов файла</p>
<p>ReadFile - Чтение файла</p>
<p>GetFileSize - Получение размера файла</p>
<p>FindFirstFile - Поиск файла. </p>
<p>Как часто встречается: </p>
<p>Иногда </p>
<p>Метод взлома: </p>
<p>Я использую такой метод, запускаем FileMon. Затем запускаем игру, со вставленным компактом. Потом сразу же выходим и смотрим, к каким файлам шло обращение. Если файлы не большие можно скопировать их на ЖД, если есть большие видео, то их можно заменить любыми другими видаками маленького размера. В других случая придется править переходы. Если используются все эти функции придется попотеть. </p>
<p>Примеры игр: </p>
<p>Project IGI, в этой игре были два файла по 1 байту, я их скопировал на диск C: в корневой, изменил после GetDriveTypeA сравнение и все. </p>
<p>5) Проверка на запись файла </p>
<p>Теория: Для этого используются функции WriteFile и GetLastError. Одна для записи файла другая для проверки ошибки, если они стоят подряд, то это явно она. </p>
<p>Как часто встречается: </p>
<p>Ни разу не встречал </p>
<p>Метод взлома: </p>
<p>Чуть-чуть исправленный метод из предыдущей категории. </p>
<p>Примеры игр: </p>
<p>Я же сказал: "Не встречал!" </p>
<p>6) Другие виды проверки </p>
<p>Теория: Бывают и другие сильно замусоленные проверки </p>
<p>Как часто встречается: </p>
<p>На дисках компании "Русобит" </p>
<p>Метод взлома: </p>
<p>Почитайте статьи ASMax'a на www.reversing.net </p>
<p>Примеры игр: </p>
<p>Казаки, Star Force. </p>
<p>7) Некоторые общие моменты </p>
<p>Часто в играх проверки объединены в одну общую процедуру. И удалив ее, программа начинает работать. </p>
<p>Практически всегда программа защищена совокупностью защит, которые здесь представлены в разных категориях. </p>
<p>Статья не претендует на всеобщность, поэтому я не могу предугадать ходы разработчиков. Статья открыта для дополнения, если у Вас есть какие нибудь ценные мысли по этому поводу, шлите на мыло. </p>
<p>Все ругательства отправлять в null </p>
<p>Все остальное на lomovskih@yandex.ru </p>
<p>P.S. Запомните все материалы публикуются только в учебных целях и автор за их использование ответственности не несет!! </p>
<p>P.P.S. Возможно имеют место опечатки, заранее извините! </p>
<p>With best wishes Fess </p>
<p>И да пребудет с вами великий дух bad-сектора. </p>
<p>Взято с <a href="http://delphiworld.narod.ru" target="_blank">http://delphiworld.narod.ru</a></p>
</div>

<div id="footer">
<hr/>
<p>Материал из DRKB Library<br/>Разработка и поддержка &mdash; <a title="DRKB на GitHub" href="https://github.com/quadroid/drkb" target="_blank">Quadr0</a></p>
</div>
</div>
</body>
</html>
