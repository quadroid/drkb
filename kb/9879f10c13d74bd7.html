<!DOCTYPE html>
<html>
<head>
  <title>Создание веб-приложений</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link type="text/css" href="css/css.css" rel="stylesheet"/>
  <link type="text/css" href="css/sh.css" rel="stylesheet"/>
  <script language="javascript" src="js/shInit.js"></script>
  <script language="javascript" src="js/shCore.js"></script>
  <script language="javascript" src="js/shBrushDelphi.js"></script>
  <script language="javascript" src="js/shBrushSql.js"></script>
</head>
<body>
<div id="layout">
<div id="header">
  <a title="DRKB Library" href="../splash.html"><div id="logo"></div></a>
</div>
<div id="content">
<div id="explorer">DRKB Explorer</div>
  <h1 id="title">Создание веб-приложений</h1>
<div id="date">01.01.2010</div>

<p>В. Ковалев / © mcsa.ru</p>
<p>Эпоха web-дизайна, когда наиважнейшим считалось возможность запихнуть на страницу как можно больше графики и поразить пользователя широтой фантазии дизайнера, канула в лету. В моде - информационный дизайн и всяческие удобности для пользователя. Плохим тоном уже считается одно только то, что на сайте нет форума или гостевой книги, и самое ужасное - о, боже - вы до сих пор верстаете каждую страницу вручную, вместо того, что бы поручить сеё скучное и утомительное занятие скрипту.</p>
<p>Время первопроходцев HTML в скором времени закончиться и вовсе, и их место займут профессионалы-программисты. Именно программисты, ибо уже в большей степени от их умения создать удобный в использование сайт зависит его успех. Кроме прочего, теперь сайты создают совсем уж как программные продукты: тем кто занят наполнением содержанием, уже может не опасаться запутаться в html, java, cgi и прочих ипостасях интернет-технологий - администрирование сайта становиться таким же привычным и удобным, как работа с текстовыми процессорами. Пока правда ощущается явный недостаток законченных продуктов, на плечи которых можно было бы возложить все функции по поддержанию сайта в актуальном состоянии, оставив себе лишь вопросы по наполнению его содержанием.</p>
<p>Пока же тяжкое бремя по созданию данных систем, на основе которых будет функционировать сайт, ложиться на плечи программистов, только вот-вот успевших изумится возможностями языка Perl или Java. И многие из них, сказать без преувеличения, вышли, словно из гоголевской "Шинели", из Delphi. Действительно, данная среда разработчика, предоставляющая удобный интерфейс для визуального программирования и широкие возможности Object Pascal, столь мила сердцу российских программистов.</p>
<p>Но, похоже, что времена меняются, и Delphi, из среды создания обычных настольных приложений, может сгодиться и в другом плане: для написания прикладных web-программ. И действительно, что может быть лучше: уже знакомая среда разработки, вдоль и поперек изученный язык, да и достаточно широкий круг специалистов по программированию в Delphi - это ли не плюсы создания web-приложений на Delphi. Есть конечно и минусы: созданные программы вряд ли смогут удовлетворить тех, кто считает, что лучший web-сервер, это сервер не от Microsoft. Но что поделаешь - версия Delphi под Unix отложена пока до лучших времен. Зато посудите сами: перенос программ в будущем светлом будущем можно будет совершить с малой кровью.</p>
<p>Но отложим пока теорию в сторону, и обратимся к практики. Итак, создания web-приложения в среде Delphi, что называется шаг за шагом.</p>
<p>Пример из учебника </p>
<p>В отличии от прочих аспектов создания приложений в Delphi, о создании приложений для web, написано мало. Так ужасающе мало, что из книги в книгу, из учебника в учебник путешествует один и тот же пример. Не будем оригинальничать и мы - чем проще, тем лучше. </p>
<p>Вообще, простейшее web-приложение на Delphi мало чем отличается, а точнее ничем не отличается от создания программы для старой доброй DOS. Это - простейшее консольное приложение, запускаемое на стороне сервера и взаимодействующие с пользователем (в случае необходимости) через броузер.</p>
<p>Создайте в Delphi новый проект - ту самую уже давно забытую всем Console Application. Вы получите знакомый со школьной скамьи, текст обычной паскалевской программы:</p>
<pre name="code" class="delphi">program primer;
{$APPTYPE CONSOLE}
uses SysUtils;
 
begin
// Insert user code here
end.
</pre>

<p>Далее, еще проще. Организуем вывод кода HTML с помощью команды writeln.</p>
<pre name="code" class="delphi">writeln ('CONTENT-TYPE: TEXT/HTML');
writeln;
writeln ('&lt;html&gt;');
writeln ('&lt;head&gt;');
writeln ('&lt;meta HTTP-EQUIV="Content-Type" Content="text-html; charset=windows-1251"&gt;');
writeln ('&lt;title&gt;Delphi the best facility for making web-publications!&lt;/title&gt;');
writeln ('&lt;/head&gt;');
writeln ('&lt;body bgcolor="white"&gt;');
writeln ('Hello, world!');
writeln ('&lt;/body&gt;');
writeln ('&lt;/html&gt;');
</pre>

<p>Обратите внимание на строку CONTENT-TYPE: TEXT/HTML, которая определяет описание последующего содержимого, а именно кода HTML. После CONTENT-TYPE: TEXT/HTML, необходимо вывести пустую строку иначе броузер может выдать сообщение об ошибке.</p>
<p>Теперь, когда приложение закончено, осталось его скомпилировать и проверить. Для проверки работоспособности программы вам понадобиться веб-сервер. Можно особо не утруждаться, подойдет любой, даже стандартный домашний веб-сервер от Microsoft. Приложение надо будет разместить в папке публикаций сервера (обычно это - C:\Inetpub\ wwwroot) и запустить сам сервер. Теперь, если вы перейдете по адресу http://localhost/primer.exe в броузере, вы должны увидеть результат действия данной программы - строку Hello, world! Вот и всё, простейшее web-приложение на Delphi готово.</p>
<p>Передача параметров</p>
<p>На самом деле нам бы вряд ли понадобилось Delphi, для создания подобных программ. Конечно, можно генерировать страницы исходя из различных условий, но вопрос в том, как данные условия передать программе. И здесь оказывается не всё так сложно, достаточно вспомнить передачу параметров приложению с помощью командной строки и поступить соответствующе. Хотя это разумеется хитрость. Это для приложения Delphi, мы оперируем командной строкой, для пользователя же это адресная строка в броузере, то есть url.</p>
<p>&gt;Попробуем на примере. Необходимо создать приложение, которое выдает различную информацию (к примеру, время, дату или то и другое вместе) в зависимости от параметров указанных в адресной строке броузера. Как известно, за данные в параметрах отвечают такие функции как ParamCount и ParamStr. Их то мы и будем использовать.</p>
<pre name="code" class="delphi">program CgiDate;
 
{$APPTYPE CONSOLE}
 
uses SysUtils;
 
begin
  writeln('CONTENT-TYPE: TEXT/HTML');
  writeln;
  writeln('&lt;HTML&gt;&lt;HEAD&gt;');
  writeln('&lt;TITLE&gt;Cgidate&lt;/TITLE&gt;');
  writeln('&lt;/HEAD&gt;&lt;BODY&gt;&gt;');
  writeln('&lt;H1&gt;Пример передачи параметров&lt;/H1&gt;');
  writeln('&lt;HR&gt;');
  writeln('&lt;H4&gt;');
 
  if ParamCount &gt; 0 then
    begin
      if ParamStr(1) = 'date' then
        writeln(FormatDateTime('"Сегодня " dddd, mmmm d, yyyy', Now))
      else if ParamStr(1) = 'time' then
        writeln(FormatDateTime('"Время" hh:mm:ss AM/PM', Now))
      else if ParamStr(1) = 'both' then
        writeln(FormatDateTime('"Сегодня " dddd, mmmm d, yyyy,'
          + '"&lt;p&gt; и время" hh:mm:ss AM/PM', Now))
      else
        writeln('Ошибка! Неверный параметр: ' + ParamStr(1) + '.')
    end
  else
    writeln('Параметр отсутствует.');
  writeln('&lt;/BODY&gt;&lt;/HTML&gt;');
end.
</pre>

<p>Не правда ли просто? Теперь, если в адресной строке броузера вы наберете, например http://localhost/cgidate/exe?time, будет сгенерирована страница отображающая текущее время, http://localhost/cgidate/exe?date - соответственно дата, а при передачи параметра both - текущая дата и время. В случае если никакой из параметров передан не был или он был ошибочен - возникнет сообщение об этом.</p>
<p>Данные адреса и параметры можно непосредственно указать в коде HTML и генерировать необходимые изменения на странице либо другие страницы переходя по соответствующим ссылкам.</p>
<p>Следует обратить внимание на то, как передавать данные через url. Знак вопроса отделяет параметр от адреса файла, с помощью знака равенства web-приложению передается значение данного параметра. Так как в адресной строке нельзя использовать пробел, он заменяется на шестнадцатеричный код в таблице ASCII, то есть %20.</p>
<p>Но на самом деле, если некие данные передаться от пользователя web-приложению, то обычно для этого используют формы, а не url (хотя одно другому не мешает). Попробуем и мы создать приложение, которое бы получала данные от пользователя, занесенные им в форму.</p>
<p>Для начала естественно нужно создать сам код HTML в котором бы присутствовала форма с полями ввода, кнопкой отправки и прочими необходимыми атрибутами. При этом form action должен содержать адрес программы, которая будет получать данные. Значение method может быть равно как GET, так и POST. На самом деле GET - это и есть передача параметров через url, добавляя их к адресной строке, так как POST передает их приложению посредством стандартного потока ввода. Какой из них лучше и удобней решать вам, но чаще всего метод GET использует именно для генерации страниц (достаточно взглянуть на url который возникает при работе на поисковых серверах), так как второй для передачи данных, отображать которые в адресной строке было бы весьма накладно.</p>
<p>Затем необходимо создать приложение, которое бы адекватно смогло воспринять все эти данные со стороны пользователя. В случае если данные передавались с помощью метода GET проблем не будет - можно действовать как в предыдущем примере. Если же приложение получает данные от пользователя с помощью POST, всё несколько иначе.</p>
<p>Необходимо будет считывать данные из переменной окружения, а для этого мы естественно должны знать данные переменные.</p>
<p>Гюльчитай, открой личико</p>
<p>Нет в мире тайн. Особенно их мало у пользователя от web-приложения. И если мы не знаем о пользователе кое-что личное, все прочее, броузеры с легкостью отдают web-серверу, нисколько не заботясь о приватности и желаниях того самого пользователя. Это конечно не хорошо для пользователя, но хорошо для разработчика web-приложения, поскольку для него знания - великая вещь.</p>
<p>Итак, данные от пользователя web-приложению, можно передать через переменные окружения. Вот список наиболее часто употребляемых:</p>
<p>GATEWAY_INTERFACE</p>
<p>Поддерживаемая версия CGI.</p>
<p>REQUEST_METHOD </p>
<p>Метод запроса, может быть как GET так и POST.</p>
<p>HTTP_REFERER </p>
<p>Адрес страницы (url), активирующей текущее приложение на web-сервере.</p>
<p>PATH_INFO </p>
<p>Путь переданный приложению расположенный между именем приложения и строкой запроса.</p>
<p>QUERY_STRING </p>
<p>Строка запроса, если метод - GET, добавляеться к url.</p>
<p>REMOTE_HOST </p>
<p>Имя хоста удаленного пользователя.</p>
<p>REMOTE_USER </p>
<p>Имя удаленного пользователя.</p>
<p>REMOTE_IDENT </p>
<p>IP-адрес удаленного пользователя.</p>
<p>HTTP_USER_AGENT </p>
<p>Имя и версия броузера удаленного пользователя.</p>
<p>С помощью данных переменных можно получить исчерпывающею информацию о пользователе и передаваемых данных для верного проектирования вашего web-приложения. Конечно, этого хватит в том случае, если вы не собираетесь подобно Большому Брату следить за каждым телодвижением пользователя.</p>
<p>Но вернемся к поставленной задаче - передаче данных приложению от пользователя через форму. Данные, которые передаться через QUERY_STRING в приложение с помощью метода POST достаточно просто извлечь для использования.</p>
<p>Ниже листинг программы, выдающий список некоторых переменных окружения и их значения. Узнайте кое-что о своем броузере и web-сервере.</p>
<pre name="code" class="delphi">program CgiVars;
 
{$APPTYPE CONSOLE}
 
uses
  Windows;
 
сonst
VarList: array[1..17] of string[30] =
('SERVER_NAME', 'SERVER_PROTOCOL',
  'SERVER_PORT', 'SERVER_SOFTWARE',
  'GATEWAY_INTERFACE', 'REQUEST_METHOD',
  'PATH_TRANSLATED', 'HTTP_REFERER',
  'SCRIPT_NAME', 'PATH_INFO',
  'QUERY_STRING', 'HTTP_ACCEPT',
  'REMOTE_HOST', 'REMOTE_USER',
  'REMOTE_ADDR', 'REMOTE_IDENT',
  'HTTP_USER_AGENT');
 
var
  I: Integer;
  ReqVar: string;
  VarValue: array[0..200] of Char;
 
begin
  writeln('Content type: text/html');
  writeln;
  writeln('&lt;HTML&gt;&lt;HEAD&gt;');
  writeln('&lt;TITLE&gt;CGI Variables&lt;/TITLE&gt;');
  writeln('&lt;/HEAD&gt;&lt;BODY&gt;');
  writeln('&lt;H1&gt;CGI Variables&lt;/H1&gt;');
  writeln('&lt;HR&gt;&lt;PRE&gt;');
 
  for I := Low(VarList) to High(VarList) do
    begin
      ReqVar := VarList[I];
      if (GetEnvironmentVariable(PChar(ReqVar),
        VarValue, 200) &gt; 0) then
      else
        VarValue := '';
      writeln(VarList[I] + ' = ' + VarValue);
    end;
  writeln('&lt;/PRE&gt;&lt;/BODY&gt;&lt;/HTML&gt;');
end.
</pre>

<p>За кадром</p>
<p>В этой статье мы не коснулись другой и уж наверняка более обширной и сложной темы, как создание ISAPI-приложений на Delphi. Вышеприведенные способы создания приложений годны лишь в том случае, если вам необходимо быстрое, компактное и не слишком сложное web-приложение. Если же вам необходим, к примеру, доступ к базам данным, то подобный путь неприемлем.</p>
<p>Для создания полномасштабных приложений для интернета, в Delphi существует специальный помощник - Web Server Application. С его помощью можно создать </p>
<p>приложение генерируемое динамические web-страницы, основанные на CGI, NSAPI или ISAPI. Единственное накладываемое ограничение - непосредственно web-сервер должен работать на базе Windows. </p>
<p>Одним из главных преимуществ создания подобных приложений именно в среде Delphi является то, что вы продолжаете работать с визуальными компонентами - это значительно проще, чем создание приложений в других средах - возможность ошибки в больших проектах, где используется визуальное проектирование меньше, чем в тех, где всё описывается исключительно кодом. Кроме того средства создания web-приложений позволяют импортировать уже существующие приложения в интернет-среду, что согласитесь немаловажно. Пока, конечно, Delphi не обладает большим набором компонентов для web-приложений, но видимо уже следующая версия этой среды обзаведется необходимыми. Но и сейчас Delphi можно считать достаточно удобным инструментом для создания приложений взаимодействующих с интернетом.</p>
<p>Взято из <a href="http://forum.sources.ru" target="_blank">http://forum.sources.ru</a></p>
</div>

<div id="footer">
<hr/>
<p>Материал из DRKB Library<br/>Разработка и поддержка &mdash; <a title="DRKB на GitHub" href="https://github.com/quadroid/drkb" target="_blank">Quadr0</a></p>
</div>
</div>
</body>
</html>
